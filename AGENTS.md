---
default_branch: main
package_manager: bun
node_version: "22.20.0"
start_command: "bun run d"
dev_command: "bun run dev"
build_command: "bun run build"
test_commands:
  - "bun run lint"
  - "bun run type-check"
  - "bunx vitest run"
ports:
  dev: 3000
required_env: []
optional_env:
  - TELEMETRY_ENABLED
  - EMDASH_DB_FILE
  - EMDASH_DISABLE_NATIVE_DB
  - CODEX_SANDBOX_MODE
  - CODEX_APPROVAL_POLICY
---

**Quickstart**
1. `nvm use` (installs Node 22.20.0 if missing) or install Node 22.x manually.
2. `bun run d` to install dependencies and launch Tauri + Vite.
3. If `bun run d` fails mid-stream, rerun `bun install`, then `bun run dev`.

**Testing**
1. Run `bun run lint`.
2. Run `bun run type-check`.
3. Run `bunx vitest run` (tests live under `src/**/*.test.ts`).

**Build & Package**
1. `bun run build` to compile the Tauri app and Vite renderer.
2. Bundles land under `src-tauri/target/release/bundle/` (DMG/AppImage/MSI depending on platform).

**Repo Map**
- `src-tauri/src/` – Tauri commands, IPC, database access, CLI orchestration (Rust).
- `src/renderer/` – React UI, providers, terminal panes, integrations.
- `src/shared/` & `src/types/` – Shared utilities and type definitions.
- `drizzle/` – SQLite migrations generated by Drizzle ORM (`drizzle.config.ts` controls paths).
- `build/` – Legacy build assets; avoid casual edits.

**Guardrails**
- Do work on branches or worktrees; default branch is `main`, never push directly.
- Do limit edits to `src/**`, `docs/**`, or config files you fully understand; keep binaries, `dist/`, and `release/` untouched.
- Do keep secrets local; configure providers via their CLIs, not committed files.
- Don't rewrite Drizzle migration history (`drizzle/meta`, numbered SQL) without coordinating.
- Don't modify telemetry defaults or updater logic unless the change is intentional and reviewed.
- Don't run commands that mutate global environments (package installs, git pushes) from agent scripts.

**Risky Areas**
- `src-tauri/src/pty.rs` – manages long-lived PTY processes and log streaming; race conditions or unhandled exits can kill agent runs.
- `src-tauri/src/db.rs` + `drizzle/` – schema migrations and SQLite access; mismatches can corrupt user data.
- `src-tauri/src/container.rs` – docker orchestration; regressions can break preview/connect flows.

**Pre-PR Checklist**
- [ ] Dev server runs: `bun run d` (or `bun run dev`) starts cleanly.
- [ ] Tests and checks pass: `bun run lint`, `bun run type-check`, `bunx vitest run`.
- [ ] No stray build artifacts or secrets committed.
- [ ] Documented any schema or config changes impacting users.
